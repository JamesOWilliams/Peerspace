{% extends 'layout.html' %}
{% block title_tag %}Feed | {{ block.super }}{% endblock %}
{% load static %}
{% block body_content %}
<!-- Peerspace specific stylesheets -->
<link rel="stylesheet" href="{% static 'posts/css/post.css' %}">
<!-- jQueryUi specific stylesheets -->
<link rel="stylesheet" type="text/css" href="https://code.jquery.com/ui/1.12.1/themes/flick/jquery-ui.css">
<!-- Tagit specific stylesheets -->
<link href="{% static 'css/jquery.tagit.css' %}" rel="stylesheet" type="text/css">
<div class="container post-feed">
  <div class="row">
    <div class="user-info col-lg-3">
      <div class="card card-profile mb-4">
        <div class="card-header" style="background-image: url({{ profile_pictures.user_cover_pic }});"></div>
        <div class="card-body text-center">
          <a href="profile/index.html">
            <img class="card-profile-img" src="{{ profile_pictures.user_profile_pic }}">
          </a>
          <h6 class="card-title">
            <a class="text-inherit" href="{% url 'users:profile_user' %}">{{ user.name}}</a>
          </h6>
          <p class="mb-4">{{ user.bio }}</p>
          <ul class="card-menu">
            <li class="card-menu-item">
              <a href="#userModal" class="text-inherit" data-toggle="modal">
                Followers
                <h6 class="my-0">{{ user.follows.count }}</h6>
              </a>
            </li>
            <li class="card-menu-item">
              <a href="#userModal" class="text-inherit" data-toggle="modal">
                Posts
                <h6 class="my-0">{{ number_of_posts }}</h6>
              </a>
            </li>
          </ul>
        </div>
      </div>
    </div>
    <div class="col-lg-3"></div>
    <ul class="col-lg-6 media-list media-list-stream mb-3">
      <form class="" method="POST">
        <div class="form-group">
          <!-- <label for="exampleFormControlInput1">Title:</label> -->
          <input type="email" placeholder="Title" class="form-control" id="title" placeholder="">
        </div>
        <div class="form-group">
          <!-- <label for="exampleFormControlTextarea1">Description</label> -->
          <textarea class="form-control" placeholder="Description" id="desc" rows="3"></textarea>
        </div>
        <div class="form-group">
          <!-- <label for="exampleFormControlTextarea1">Tags</label> -->
          <ul id="tags">
          </ul>
        </div>
        <button data-toggle="collapse" href="#collapseExample" aria-expanded="false" aria-controls="collapseExample" type="submit" id="post" class="btn btn-primary">Post</button>
      </form>
      <post-feed></post-feed>
    </ul>
  </div>
</div>
<script src="{% static 'bower_components/riot/riot.min.js' %}"></script>
<script src="https://cdn.jsdelivr.net/npm/js-cookie@2/src/js.cookie.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.12/jquery-ui.min.js" type="text/javascript" charset="utf-8"></script>
<script src="{% static 'js/tag-it.js' %}" type="text/javascript" charset="utf-8"></script>
<script src="{% static 'js/csrf.js' %}"></script>
<script src="{% static 'js/post.js' %}"></script>
<script src="{% static 'tags/post-feed.js' %}"></script>
<script>
  // For development
  //var root_url = 'https://127.0.0.8:8000'
  // For production
  var root_url = 'https://peerspace.herokuapp.com'
  $(document).ready(function() {
    $("#tags").tagit()
    $('.ui-widget-content')
      .attr('placeholder', 'Tags')
      .addClass('form-contol')
  function tagCallBack(theTag) {
    //Gets posts
    $.ajax({
      type: "GET",
      url: root_url + "/posts/api/v1/feed/" + user_id,
      dataType: 'json',
      success: function(data) {
        user_id = {{ user.id }}
        theTag.trigger('data_loaded', data, user_id)
      }
    });
  }
  $("#tags").tagit();
  post({{ user.id }})
  function mount() {
    riot.mount('post-feed', {callback:tagCallBack})
  }
  mount()
  })
</script>
{% endblock %}
