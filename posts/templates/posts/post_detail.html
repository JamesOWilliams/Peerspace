{% extends 'layout.html' %}
{% load static %}
{% block body_content %}
<link rel="stylesheet" href="{% static 'posts/css/post.css' %}">
<ul class="media-list post-feed media-list-stream mb-3">
 <post-view></post-view>
</ul>
<script src="{% static 'bower_components/riot/riot.min.js' %}"></script>
<script src="{% static 'tags/post-view.js' %}"></script>
<script src="https://cdn.jsdelivr.net/npm/js-cookie@2/src/js.cookie.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<script>
riot.mount('post-view', {callback:tagCallBack})

function tagCallBack(theTag) {
  //Gets posts
  $.ajax({
    type: "GET",
    url: "http://127.0.0.1:8000/posts/api/v1/{{ post.id }}",
    dataType: 'json',
    success: function(data) {
      user_id = {{ user.id }}
      theTag.trigger('data_loaded', data, user_id)
    }
  });
}
$(document).ready(function() {
  $('.like-btn').click(function(e) {
    // Stop the page refreshing when the button is clicked
    e.preventDefault()
    var this_button = $(this)
    console.log(this)
    $.ajax({
      url: "http://127.0.0.1:8000/posts/api/v1/" + this_button.attr('id') + "/like",
      method: "GET",
      data: {},
      success: function(data) {
        if (data.liked) {
          this_button.css('color', '#007bff')
        } else {
          this_button.css('color', 'grey')
        }
      }, error: function(error) {
        //console.log('Error: ' + error)
      }
    })
  })
})
</script>

{% endblock %}
